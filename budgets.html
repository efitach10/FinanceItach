<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>转拽爪</title>

<style>
body{margin:0;font-family:sans-serif;background:#0f172a;color:#fff}
.card{background:#1e293b;margin:20px;padding:20px;border-radius:14px}
input,select{width:100%;padding:8px;margin:5px 0;border-radius:8px;border:none}
button{padding:10px;background:#f59e0b;border:none;border-radius:10px;margin-top:10px}
.budget-item{background:#334155;padding:12px;border-radius:12px;margin-top:10px}
.progress{height:8px;background:#1f2937;border-radius:6px;margin-top:8px}
.progress-bar{height:8px;border-radius:6px}
footer{position:fixed;bottom:0;width:100%;background:#111827;display:flex;justify-content:space-around;padding:10px 0}
footer a{color:#94a3b8;text-decoration:none;font-size:12px;text-align:center}
footer a.active{color:#f59e0b}
</style>
</head>
<body>

<div class="card">
<h3>专转 转拽爪 砖</h3>

<select id="categorySelect"></select>
<input type="number" id="budgetAmount" placeholder="住 转拽爪 砖">
<button onclick="saveBudget()">砖专 转拽爪</button>

</div>

<div class="card">
<h3>转拽爪 砖</h3>
<div id="budgetsList"></div>
</div>

<footer>
<a href="index.html"> 转</a>
<a href="movements.html"> 转注转</a>
<a href="budgets.html" class="active"> 转拽爪</a>
<a href="savings.html"> 住转</a>
<a href="history.html"> 住专</a>
<a href="settings.html">锔 专转</a>
</footer>

<script src="js/storage.js"></script>
<script src="js/categories.js"></script>
<script src="js/movements.js"></script>
<script src="js/budgets.js"></script>
<script src="js/ui.js"></script>

<script>

populateCategorySelect("categorySelect","expense");

function saveBudget(){
    const category = document.getElementById("categorySelect").value;
    const amount = document.getElementById("budgetAmount").value;

    if(!category || !amount) return alert("  ");

    setBudget(category, amount);
    renderBudgets();
}

function renderBudgets(){

    const container = document.getElementById("budgetsList");
    container.innerHTML = "";

    const month = new Date().getMonth();
    const monthMovements = getMovementsByMonth(month);

    getAllBudgets().forEach(budget => {

        const spent = monthMovements
            .filter(m => m.type === "expense" && m.category === budget.category)
            .reduce((sum,m)=>sum+m.amount,0);

        const percent = Math.min((spent / budget.amount) * 100, 100);

        const div = document.createElement("div");
        div.className = "budget-item";

        div.innerHTML = `
            <strong>${budget.category}</strong><br>
            转拽爪: ${formatCurrency(budget.amount)}<br>
            爪 驻注: ${formatCurrency(spent)}
            <div class="progress">
                <div class="progress-bar" 
                    style="width:${percent}%;
                           background:${percent>90?'#ef4444':percent>70?'#f59e0b':'#10b981'}">
                </div>
            </div>
            <small>${percent.toFixed(0)}%</small>
        `;

        container.appendChild(div);
    });
}

renderBudgets();

</script>

</body>
</html>
