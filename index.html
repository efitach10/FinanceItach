<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Itach Home Finance - ×“×£ ×”×‘×™×ª</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.3.0/chart.min.css" />

<style>
:root {
    --bg:#0f172a;
    --card:#1e293b;
    --soft:#334155;
    --text:#f1f5f9;
    --muted:#94a3b8;
    --accent:#f59e0b;
    --positive:#10b981;
    --negative:#ef4444;
    --shadow:0 10px 30px rgba(0,0,0,0.4);
}

body{
    margin:0;
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
    background:var(--bg);
    color:var(--text);
}

header{
    padding:30px 20px;
    text-align:center;
    border-bottom:1px solid #1f2937;
}

.logo{
    display:flex;
    justify-content:center;
    align-items:center;
    gap:12px;
    direction:ltr;
}

.logo-icon{
    width:44px;
    height:44px;
    border-radius:12px;
    background:var(--accent);
    color:#111;
    font-weight:bold;
    display:flex;
    align-items:center;
    justify-content:center;
}

.logo-text{
    text-align:left;
}

.logo-text span{
    display:block;
    font-size:13px;
    color:var(--muted);
}

/* ===== MONTH/YEAR STEPPER ===== */
.summary-controls{
    display:flex;
    justify-content:center;
    gap:20px;
    margin:10px 0 20px 0;
}

.stepper{
    display:flex;
    align-items:center;
    background:var(--card);
    border-radius:12px;
    padding:5px 10px;
    box-shadow:var(--shadow);
    gap:10px;
    direction:ltr; /* force arrows to look correct in RTL */
}

.stepper button{
    background:var(--soft);
    color:var(--text);
    border:none;
    border-radius:8px;
    padding:5px 12px;
    font-size:16px;
    cursor:pointer;
    transition: background 0.2s;
}

.stepper button:hover{
    background:var(--accent);
    color:#111;
}

.stepper span{
    min-width:70px;
    text-align:center;
    font-weight:600;
    color:var(--text);
}

/* ===== SUMMARY CARDS ===== */
.cards {
    display:flex;
    flex-wrap:wrap;
    justify-content:space-around;
    gap:20px;
    padding:20px;
}

.card{
    background:var(--card);
    border-radius:16px;
    padding:20px;
    flex:1 1 250px;
    box-shadow:var(--shadow);
    border:1px solid #263244;
    transition: transform 0.2s ease;
    cursor:pointer;
}

.card:hover{
    transform: translateY(-5px);
}

.card h3{
    margin:0 0 10px;
    font-size:16px;
    color:var(--muted);
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.card span{
    font-size:22px;
    font-weight:bold;
    color:var(--text);
}

/* ===== GRAPHS ===== */
.charts{
    display:flex;
    flex-wrap:wrap;
    gap:20px;
    padding:0 20px 20px 20px;
}

.chart-card{
    background:var(--card);
    border-radius:16px;
    padding:20px;
    flex:1 1 400px;
    box-shadow:var(--shadow);
    border:1px solid #263244;
}

/* ===== FOOTER ===== */
footer{
    position:fixed;
    bottom:0;
    width:100%;
    background:#111827;
    border-top:1px solid #1f2937;
    display:flex;
    justify-content:space-around;
    padding:10px 0;
    font-size:12px;
}

footer a{
    text-decoration:none;
    color:var(--muted);
    font-size:11px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:4px;
}

footer a.active{
    color:var(--accent);
}

footer span{
    font-size:18px;
}
</style>
</head>

<body>

<header>
<div class="logo">
    <div class="logo-icon">IHF</div>
    <div class="logo-text">
        Itach Home Finance
        <span>× ×™×”×•×œ ×›×œ×›×œ×ª ×”×‘×™×ª</span>
    </div>
</div>
</header>

<!-- ===== MONTH/YEAR STEPPER ===== -->
<div class="summary-controls">
    <!-- ×—×•×“×© -->
    <div class="stepper">
        <button id="prevMonth">â—€</button>
        <span id="monthDisplay">×—×•×“×© 1</span>
        <button id="nextMonth">â–¶</button>
    </div>

    <!-- ×©× ×” -->
    <div class="stepper">
        <button id="prevYear">â—€</button>
        <span id="yearDisplay">2026</span>
        <button id="nextYear">â–¶</button>
    </div>
</div>

<!-- ===== SUMMARY CARDS ===== -->
<div class="cards">
    <div class="card">
        <h3>×”×›× ×¡×•×ª ×”×—×•×“×© <span>ğŸ’°</span></h3>
        <span id="incomeTotal">â‚ª 0</span>
    </div>
    <div class="card">
        <h3>×”×•×¦××•×ª ×”×—×•×“×© <span>ğŸ›’</span></h3>
        <span id="expenseTotal">â‚ª 0</span>
    </div>
    <div class="card">
        <h3>×—×¡×›×•× ×•×ª <span>ğŸ’µ</span></h3>
        <span id="savingsTotal">â‚ª 0</span>
    </div>
</div>

<!-- ===== GRAPHS ===== -->
<div class="charts">
    <div class="chart-card">
        <canvas id="expensesChart"></canvas>
    </div>
    <div class="chart-card">
        <canvas id="incomeExpenseChart"></canvas>
    </div>
</div>

<!-- ===== FOOTER ===== -->
<footer>
    <a href="index.html" class="active"><span>ğŸ </span> ×‘×™×ª</a>
    <a href="movements.html"><span>ğŸ’³</span> ×ª× ×•×¢×•×ª</a>
    <a href="budgets.html"><span>ğŸ“Š</span> ×ª×§×¦×™×‘×™×</a>
    <a href="savings.html"><span>ğŸ’°</span> ×—×¡×›×•× ×•×ª</a>
    <a href="history.html"><span>ğŸ“ˆ</span> ×”×™×¡×˜×•×¨×™×”</a>
    <a href="settings.html"><span>âš™ï¸</span> ×”×’×“×¨×•×ª</a>
</footer>

<!-- ===== SCRIPTS ===== -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.3.0/chart.umd.min.js"></script>
<script src="js/api.js"></script>
<script>
let month = new Date().getMonth()+1;
let year = new Date().getFullYear();

const monthDisplay = document.getElementById("monthDisplay");
const yearDisplay = document.getElementById("yearDisplay");

function updateDisplays(){
    monthDisplay.textContent = `×—×•×“×© ${month}`;
    yearDisplay.textContent = year;
    loadDashboard();
}

// âš¡ ×œ×•×’×™×§×” ×”×¤×•×›×” ×›×“×™ ×©×”×—×¦×™× ×™×¨××• ×˜×‘×¢×™×™× ×‘×¢×‘×¨×™×ª
document.getElementById("prevMonth").onclick = ()=>{
    month++; // ×”×—×¥ ×©×××œ×” ××—×–×™×¨ ××—×•×¨×”
    if(month>12){ month=1; year++; }
    updateDisplays();
};

document.getElementById("nextMonth").onclick = ()=>{
    month--; // ×”×—×¥ ×™××™× ×” ××¢×œ×” ×§×“×™××”
    if(month<1){ month=12; year--; }
    updateDisplays();
};

document.getElementById("prevYear").onclick = ()=>{
    year++;
    updateDisplays();
};

document.getElementById("nextYear").onclick = ()=>{
    year--;
    updateDisplays();
};

async function loadDashboard(){
    try {
        const movements = await getData("movements");
        const savings = await getData("savings");

        let incomeTotal = 0, expenseTotal = 0;
        movements.forEach(m => {
            const d = new Date(m.date);
            if(d.getMonth()+1 === month && d.getFullYear() === year){
                if(m.type === "income") incomeTotal += Number(m.amount);
                if(m.type === "expense") expenseTotal += Number(m.amount);
            }
        });

        let savingsTotal = 0;
        savings.forEach(s => savingsTotal += Number(s.current));

        animateNumber("incomeTotal", incomeTotal);
        animateNumber("expenseTotal", expenseTotal);
        animateNumber("savingsTotal", savingsTotal);

        const expenseByCategory = {};
        movements.filter(m => m.type==="expense" && new Date(m.date).getMonth()+1===month && new Date(m.date).getFullYear()===year)
                 .forEach(m=>{
            if(!expenseByCategory[m.category]) expenseByCategory[m.category] = 0;
            expenseByCategory[m.category] += Number(m.amount);
        });

        const ctx1 = document.getElementById("expensesChart").getContext("2d");
        if(window.expensesChart) window.expensesChart.destroy();
        window.expensesChart = new Chart(ctx1, {
            type: "pie",
            data: {
                labels: Object.keys(expenseByCategory),
                datasets: [{
                    data: Object.values(expenseByCategory),
                    backgroundColor: ["#ef4444","#f59e0b","#10b981","#3b82f6","#8b5cf6"]
                }]
            },
            options: {
                responsive:true,
                animation:{ animateScale:true, animateRotate:true },
                plugins: { legend:{ position:"bottom" } }
            }
        });

        const incomePerMonth = Array(12).fill(0);
        const expensePerMonth = Array(12).fill(0);
        movements.forEach(m=>{
            const d = new Date(m.date);
            const idx = d.getMonth();
            if(m.type==="income") incomePerMonth[idx] += Number(m.amount);
            if(m.type==="expense") expensePerMonth[idx] += Number(m.amount);
        });

        const ctx2 = document.getElementById("incomeExpenseChart").getContext("2d");
        if(window.incomeExpenseChart) window.incomeExpenseChart.destroy();
        window.incomeExpenseChart = new Chart(ctx2, {
            type: "bar",
            data: {
                labels: Array.from({length:12},(_,i)=>`×—×•×“×© ${i+1}`),
                datasets: [
                    { label:"×”×›× ×¡×•×ª", data: incomePerMonth, backgroundColor:"#10b981" },
                    { label:"×”×•×¦××•×ª", data: expensePerMonth, backgroundColor:"#ef4444" }
                ]
            },
            options: {
                responsive:true,
                animation:{ duration:1000, easing:'easeOutQuart' },
                plugins:{ legend:{ position:"bottom" } }
            }
        });

    } catch(err){
        console.error(err);
    }
}

function animateNumber(id, value){
    const el = document.getElementById(id);
    let start = 0;
    const duration = 500;
    const stepTime = Math.max(Math.floor(duration / value),1);
    const timer = setInterval(()=>{
        start += Math.ceil(value/30);
        if(start>=value){ start=value; clearInterval(timer); }
        el.textContent = `â‚ª ${start}`;
    }, stepTime);
}

window.onload = updateDisplays;
</script>

</body>
</html>
